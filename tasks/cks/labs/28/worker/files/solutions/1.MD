# Solution for lab 28

0. Connect to the kubernetes node and go to the root user:

```sh
kubectl get nodes

ssh <NODE-ip>

sudo -i
```

1. Identify what's calling `/dev/mem` using falco. Prepare a custom falco rule, that handles that.

```sh
vim /etc/falco/falco_rules.local.yaml
```

```yaml
- rule: Detect access to /dev/mem
  desc: Detect any process attempting to access /dev/mem
  condition: >
    fd.name=/dev/mem
  output: >
    user=%user.name container=%container.name namespace=%k8s.ns.name pod=%k8s.pod.name
  priority: WARNING
```

1. Run falco and check the output:

```
$ falco

....
10:59:09.888721557: Warning user=root container=app3 namespace=north pod=app3-d8cfcf44-q7nq4 deployment=<NA>
...
```
Here we might identify that app3 is calling /dev/mem. It means that we need to scale down app3 deployment.

3. Scale deployment `app3` to 0 replicas:

```sh
kubectl scale deployment -n north app3 --replicas=0
```

```sh 
check_result 
```
``` 
 ✓ 0  Init  
 ✓ 1 Check that proper deployment was scaled to 0

2 tests, 0 failures
 result = 100.00 %   ok_points=1  all_points=1  
time_left=349 minutes
you  spend 10 minutes

```