# Task 04: Configure AuthorizationPolicy for Specific Paths

### Step 1: Switch to Correct Context

```bash
kubectl config use-context cluster3-admin@cluster3
```

### Step 2: Create AuthorizationPolicy

```bash
kubectl apply -f - <<'EOF'
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: sun-and-moon
  namespace: blue
spec:
  selector:
    matchLabels:
      app: echo-version
  action: ALLOW
  rules:
    - to:
        - operation:
            paths: ["/sun", "/moon"]
EOF
```

### Step 3: Verify Configuration

```bash
# Check the policy exists
kubectl get authorizationpolicy -n blue

# Describe the policy
kubectl describe authorizationpolicy sun-and-moon -n blue

# View the full configuration
kubectl get authorizationpolicy sun-and-moon -n blue -o yaml
```

### Test 1: Access Allowed Paths

```bash

kubectl exec sleep-blue -n blue -- curl http://echo-version-v1.blue.svc.cluster.local/sun

{"pod_name":"echo-version-v1-5fc59b6884-gnwkz","version":"v1","namespace":"blue"}

```

Expected output: `200`

### Test 2: Access Denied Paths

```bash
# Test /mars endpoint (should fail - 403)
kubectl exec sleep-blue -n blue -- curl http://echo-version-v1.blue.svc.cluster.local/pluto

RBAC: access denied

```
