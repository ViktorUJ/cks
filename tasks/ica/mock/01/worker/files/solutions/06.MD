# Task 06: Fault Injection - HTTP Abort

### Step 1: Switch to Correct Context

```bash
kubectl config use-context cluster3-admin@cluster3
```

### Step 2: Create VirtualService with Fault Abort

```bash
kubectl apply -f - <<EOF
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: purple-vs
  namespace: purple
spec:
  hosts:
    - purple-echo
  http:
    - fault:
        abort:
          percentage:
            value: 100.0
          httpStatus: 503
      route:
        - destination:
            host: purple-echo.purple.svc.cluster.local
            port:
              number: 8080
EOF
```

### Step 4: Verify Configuration

```bash
# Check VirtualService exists
kubectl get virtualservice -n purple

# View fault injection config
kubectl get virtualservice purple-vs -n purple -o yaml | grep -A 5 fault
```

## Testing

### Test Request Abortion

```bash
kubectl exec -n red sleep-red -- curl -I http://purple-echo.purple.svc.cluster.local:8080/mars
```

**Expected output:**
```
HTTP/1.1 503 Service Unavailable
content-length: 18
content-type: text/plain
date: Sun, 02 Nov 2025 18:29:08 GMT
server: envoy
```
