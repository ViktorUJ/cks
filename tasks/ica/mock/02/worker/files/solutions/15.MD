# Task 15: AuthorizationPolicy in Navy Namespace

### Step 1: Switch to Correct Context

```bash
kubectl config use-context cluster3-admin@cluster3
```

### Step 2: Create AuthorizationPolicy

```bash
kubectl apply -f - <<'EOF'
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: allow-get-policy
  namespace: navy
spec:
  action: ALLOW
  selector:
    matchLabels:
      app: navy
  rules:
  - from:
    - source:
        namespaces: ["turquoise"]
    to:
    - operation:
        paths: ["/pluto"]
EOF
```

## Verification

```bash
# Check AuthorizationPolicy
kubectl get authorizationpolicy -n navy
kubectl describe authorizationpolicy allow-get-policy -n navy
```

## Testing

```bash
# Test from turquoise namespace to /pluto path (should work)
kubectl exec -n turquoise sleep-turquoise -- curl -s http://navy-echo.navy/pluto

# Test from another namespace (should fail with RBAC: access denied)
kubectl exec -n black sleep-black -- curl -s http://navy-echo.navy/pluto

# Test different path from turquoise (should fail with 403)
kubectl exec -n turquoise sleep-turquoise -- curl -s http://navy-echo.navy/mars

# Expected responses:
# - turquoise → /pluto: JSON response from navy service
# - other namespace: RBAC: access denied
# - turquoise → other path: RBAC: access denied (403)
```

**Note:** The service name is `navy-echo` (not `navy-service`) and sleep pods are named `sleep-turquoise` and `sleep-black` (without `-test` suffix).
