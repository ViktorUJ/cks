
[documentation](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)

[example](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/)

### steps  
* check cpu load (find min and max usage )
* add request / limit  
* create HPA
* check result



```
watch -n 1  'kubectl top po  -n prod-jobs ; kubectl get po -n prod-jobs '

```

```
# max usage (usage time)
 
NAME                   CPU(cores)   MEMORY(bytes)
app-6f6846bc44-8hfm6   267m         1Mi
NAME                   READY   STATUS    RESTARTS   AGE
app-6f6846bc44-8hfm6   1/1     Running   0          20m


```

``` 
# min usage  (idle  time)

NAME                   CPU(cores)   MEMORY(bytes)
app-6f6846bc44-8hfm6   15m          1Mi
NAME                   READY   STATUS    RESTARTS   AGE
app-6f6846bc44-8hfm6   1/1     Running   0          21m

```
``` 
# update deployment (add resources.limits.cpu     resources.requests.cpu
# 

  generation: 1
  labels:
    app: app
  name: app
  namespace: prod-jobs
  resourceVersion: "779"
  uid: c4f19a91-8549-4424-83fd-814d79291d3e
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: app
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: app
    spec:
      containers:
      - env:
        - name: ENABLE_LOAD_CPU
          value: "true"
        - name: CPU_MAXPROC
          value: "1"
        - name: CPU_USAGE_PROFILE
          value: 1=800=1=60 1=30=1=60
        image: viktoruj/ping_pong
        imagePullPolicy: Always
        name: ping-pong-cp6bg
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        resources:                                 # add
           limits:                                 # add 
             cpu: 400m                             # add 
           requests:                               # add 
             cpu: 20m                              # add 
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30

```