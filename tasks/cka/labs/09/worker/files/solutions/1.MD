https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io%2fv1.HTTPHeaderMatch

```
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: nginx-gateway
  namespace: nginx-gateway
spec:
  gatewayClassName: nginx
  listeners:
    - name: http
      port: 80
      protocol: HTTP
      allowedRoutes: 
       namespaces: 
        from: All
```

``` 
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: app
  namespace: app
spec:
  parentRefs:
  - name: nginx-gateway
    namespace: nginx-gateway
    sectionName: http 
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    - name: app-prod
      port: 80

```

``` 
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: app
  namespace: app
spec:
  parentRefs:
    - name: nginx-gateway
      namespace: nginx-gateway
      sectionName: http
  rules:
    # Правило для environment=dev → направляем на app-dev
    - matches:
        - path:
            type: PathPrefix
            value: /
          headers:
            - name: environment
              value: dev
      backendRefs:
        - name: app-dev
          port: 80

    # Правило для мобильных устройств на базе Android:
    - matches:
        - path:
            type: PathPrefix
            value: /
          headers:
            - name: User-Agent
              type: RegularExpression
              value: "Android"
      backendRefs:
        - name: app-mobile
          port: 80

    # Правило для мобильных устройств на базе iPhone:
    - matches:
        - path:
            type: PathPrefix
            value: /
          headers:
            - name: User-Agent
              type: RegularExpression
              value: "iPhone"
      backendRefs:
        - name: app-mobile
          port: 80

    # Правило по умолчанию → направляем на app-prod
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: app-prod
          port: 80


```


check 
``` 
curl cka.local:30102

curl -H "environment: dev" cka.local:30102 | grep 'Server Name'

curl -s  -H "User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Mobile/15A372 Safari/604.1" cka.local:30102 | grep 'Server Name'

```